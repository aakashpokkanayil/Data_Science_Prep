use learn46;

CREATE FUNCTION MYSUM (@A AS INT, @B AS INT)
RETURNS INT
AS
BEGIN
	DECLARE @C AS INT;
	SET @C = @A + @B;
	RETURN @C;
END;

SELECT DBO.MYSUM(10,20);

CREATE FUNCTION CAL (@X AS INT, @Y AS INT, @O AS CHAR(1))
RETURNS INT
AS
BEGIN
	DECLARE @R  AS INT;
	IF @O = '+'
		SET @R = @X + @Y;
	ELSE IF @O = '-'
		SET @R = @X - @Y;
	ELSE IF @O = '*'
		SET @R = @X * @Y;
	ELSE IF @O = '/'
		SET @R = @X / @Y;
	ELSE IF @O = '%'
		SET @R = @X % @Y;
	ELSE 
		SET @R = 0;
	RETURN @R;
END;

SELECT DBO.CAL(25,4, '*');

-- E0001 RAJEEV  GARG OUTLOOK - RGARG0001@OUTLOOK.COM

CREATE FUNCTION CMAIL (@ID AS CHAR(5), @N AS VARCHAR(40), @D AS VARCHAR(30))
RETURNS VARCHAR(100)
AS
BEGIN
	DECLARE @EM AS VARCHAR(100);
	DECLARE @L AS INT;
	DECLARE @S AS INT;
	DECLARE @LN AS VARCHAR(20);

	SET @L = LEN (@N);
	SET @S = CHARINDEX(' ', @N);
	SET @LN = RIGHT(@N, @L- @S);

	SET @EM = UPPER(CONCAT(LEFT(@N,1), @LN, RIGHT(@ID, 4), '@', @D, '.COM'));
	RETURN @EM;
END;

SELECT DBO.CMAIL('E0001', 'RAJEEV GARG', 'RCORP');

SELECT * FROM EMP;
SELECT EID, NAME,  DBO.CMAIL(EID, NAME, 'OUTLOOK') AS 'CORPMAIL'
FROM EMP;


-- SCALAR FUNCTION \ SINGLE VALUED
-- TABLE VALUED FUNCTION

	
	USE  TEST;

CREATE FUNCTION L46FNSAL()
RETURNS TABLE
AS
	RETURN(SELECT EMP.EID, NAME, CITY, DOJ, DEPT, DESI, SALARY AS 'BASIC', SALARY *.15 AS 'HRA', SALARY *.09 AS 'PF'
	FROM EMP
	INNER JOIN EMP_SAL
	ON EMP.EID = EMP_SAL.EID
	WHERE DEPT = 'HR');

DROP FUNCTION L46FNSAL;
SELECT * FROM DBO.L46FNSAL();

CREATE FUNCTION L46FNSAL(@D AS VARCHAR(30))
RETURNS TABLE
AS
	RETURN(SELECT EMP.EID, NAME, CITY, DOJ, DEPT, DESI, SALARY AS 'BASIC', SALARY *.15 AS 'HRA', SALARY *.09 AS 'PF'
	FROM EMP
	INNER JOIN EMP_SAL
	ON EMP.EID = EMP_SAL.EID
	WHERE DEPT = @D);

SELECT * FROM DBO.L46FNSAL('IT');


SELECT * FROM EMP;
SELECT * FROM EMP_SAL;


SELECT EID, NAME,  CITY, DOJ FROM EMP;

SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER';

SELECT EID, NAME,  CITY, DOJ FROM EMP
WHERE EID IN(1004, 1007, 1008, 1010, 1013, 1028, 1067, 1040, 1074, 1088, 1123, 1231);


SELECT EID, NAME,  CITY, DOJ FROM EMP -- OUTER \MAIN
WHERE EID IN(SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER'); --INNER \SUB

SELECT EID, DEPT, DESI, SALARY FROM EMP_SAL
WHERE EID IN(SELECT EID FROM EMP WHERE CITY = 'DEHRADUN');

SELECT EMP.EID, NAME , DEPT , DESI
FROM EMP
INNER JOIN EMP_SAL
ON   EMP.EID = EMP_SAL.EID
WHERE DEPT = 'MIS';

SELECT * FROM TRAINING;

-- INSERT SUB QUERY
INSERT INTO TRAINING (EID, NAME, DEPT)
SELECT EMP.EID, NAME , DEPT 
FROM EMP
INNER JOIN EMP_SAL
ON   EMP.EID = EMP_SAL.EID
WHERE DEPT = 'MIS';

UPDATE TRAINING SET MODULE = 'SQL';

-- DELETE SUB QUERY

DELETE FROM TRAINING
WHERE EID IN (SELECT  EID FROM EMP_SAL WHERE DESI LIKE 'MANAGER%');


SELECT EID, DEPT, DESI, SALARY FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'PUNE');

-- UPDATE SUB QUERY

UPDATE EMP_SAL SET SALARY = SALARY + 5000
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'PUNE');

SELECT EID, NAME,  CITY, DOJ FROM EMP
WHERE EID IN(SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER');

SELECT EID, NAME,  CITY, DOJ FROM EMP
WHERE EID IN(SELECT EID FROM EMP_SAL WHERE SALARY > 300000 )
ORDER BY EID DESC;

SELECT EID, NAME,  CITY, DOJ FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 550000 );

SELECT EID, NAME,  CITY, DOJ FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY BETWEEN 300000 AND 400000 );